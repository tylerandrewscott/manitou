
R version 3.6.3 (2020-02-29) -- "Holding the Windsock"
Copyright (C) 2020 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> 
> #install.packages("INLA", repos=c(getOption("repos"), INLA="https://inla.r-inla-download.org/R/testing"), dep=TRUE)
> if(!require(INLA)){install.packages("INLA", repos=c(getOption("repos"), INLA="https://inla.r-inla-download.org/R/stable"), dep=TRUE)}
Loading required package: INLA
Loading required package: Matrix
Loading required package: foreach
Loading required package: parallel
Loading required package: sp
This is INLA_21.03.08 built 2021-03-11 07:23:05 UTC.
 - See www.r-inla.org/contact-us for how to get help.
 - To enable PARDISO sparse library; see inla.pardiso()
> 
> packages = c('data.table','stringr','tidyverse','sf','lwgeom','ggthemes','tigris','lubridate')
> not_installed = packages[!packages %in% installed.packages()[,'Package']]
> if(length(not_installed)>0){lapply(not_installed,install.packages)}
> lapply(packages,require,character.only = T)
Loading required package: data.table
Loading required package: stringr
Loading required package: tidyverse
â”€â”€ [1mAttaching packages[22m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 1.3.0 â”€â”€
[32mâœ“[39m [34mggplot2[39m 3.3.2     [32mâœ“[39m [34mpurrr  [39m 0.3.4
[32mâœ“[39m [34mtibble [39m 3.0.4     [32mâœ“[39m [34mdplyr  [39m 1.0.2
[32mâœ“[39m [34mtidyr  [39m 1.1.2     [32mâœ“[39m [34mforcats[39m 0.5.0
[32mâœ“[39m [34mreadr  [39m 1.4.0     
â”€â”€ [1mConflicts[22m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
[31mx[39m [34mpurrr[39m::[32maccumulate()[39m masks [34mforeach[39m::accumulate()
[31mx[39m [34mdplyr[39m::[32mbetween()[39m    masks [34mdata.table[39m::between()
[31mx[39m [34mtidyr[39m::[32mexpand()[39m     masks [34mMatrix[39m::expand()
[31mx[39m [34mdplyr[39m::[32mfilter()[39m     masks [34mstats[39m::filter()
[31mx[39m [34mdplyr[39m::[32mfirst()[39m      masks [34mdata.table[39m::first()
[31mx[39m [34mdplyr[39m::[32mlag()[39m        masks [34mstats[39m::lag()
[31mx[39m [34mdplyr[39m::[32mlast()[39m       masks [34mdata.table[39m::last()
[31mx[39m [34mtidyr[39m::[32mpack()[39m       masks [34mMatrix[39m::pack()
[31mx[39m [34mpurrr[39m::[32mtranspose()[39m  masks [34mdata.table[39m::transpose()
[31mx[39m [34mtidyr[39m::[32munpack()[39m     masks [34mMatrix[39m::unpack()
[31mx[39m [34mpurrr[39m::[32mwhen()[39m       masks [34mforeach[39m::when()
Loading required package: sf
Linking to GEOS 3.7.1, GDAL 2.4.0, PROJ 5.2.0
Loading required package: lwgeom
Linking to liblwgeom 3.0.0beta1 r16016, GEOS 3.7.1, PROJ 5.2.0
Loading required package: ggthemes
Loading required package: tigris
To enable 
caching of data, set `options(tigris_use_cache = TRUE)` in your R script or .Rprofile.
Loading required package: lubridate

Attaching package: â€˜lubridateâ€™

The following objects are masked from â€˜package:data.tableâ€™:

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year

The following objects are masked from â€˜package:baseâ€™:

    date, intersect, setdiff, union

[[1]]
[1] TRUE

[[2]]
[1] TRUE

[[3]]
[1] TRUE

[[4]]
[1] TRUE

[[5]]
[1] TRUE

[[6]]
[1] TRUE

[[7]]
[1] TRUE

[[8]]
[1] TRUE

> 
> #run = 'joint_shared'
> start_year = 2005
> end_year = 2018
> 
> ##### this determines whether models run on per-congress (i.e., two year windows) #####
> # for "CALENDAR_YEAR" or "congress"
> period_type = 'CALENDAR_YEAR'
> 
> #### this determines which projects to include ######
> keep_decisions = c('EIS','EA','CE')
> 
> td = tempdir()
> albersNA <- "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=37.5 +lon_0=-110 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m"
> admin_districts <- readRDS('policypolitics/prepped/admin_units_clean.RDS')
> st_crs(admin_districts) <- st_crs(albersNA)
> 
> 
> fs = readRDS('policypolitics/prepped/fs_PALS_cleaned_project_datatable.RDS')
> 
> 
> #system('ln -s ~/Box/manitou/output/ ~/Documents/Github/manitou')
> #system('ln -s ~/Box/manitou/input/ ~/Documents/Github/manitou')
> #file.remove(list.files('output/policypolitics/tables/',pattern = 'coefs',full.names = T))
> states = tigris::states(class = 'sf')
  |                                                                              |                                                                      |   0%  |                                                                              |                                                                      |   1%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |=====                                                                 |   8%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |=======                                                               |  11%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |=========                                                             |  14%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  16%  |                                                                              |============                                                          |  17%  |                                                                              |============                                                          |  18%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |==============                                                        |  21%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  22%  |                                                                              |================                                                      |  23%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |==========================                                            |  37%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  40%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  57%  |                                                                              |==========================================                            |  60%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  62%  |                                                                              |============================================                          |  63%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |===============================================                       |  68%  |                                                                              |================================================                      |  68%  |                                                                              |=================================================                     |  70%  |                                                                              |=================================================                     |  71%  |                                                                              |==================================================                    |  71%  |                                                                              |===================================================                   |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |====================================================                  |  74%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  76%  |                                                                              |======================================================                |  77%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  80%  |                                                                              |========================================================              |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  82%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |=============================================================         |  88%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |===============================================================       |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |====================================================================  |  97%  |                                                                              |======================================================================| 100%
> states <- st_transform(states,crs = st_crs(albersNA))
> 
> test = st_within(st_centroid(admin_districts),states)
Warning message:
In st_centroid.sf(admin_districts) :
  st_centroid assumes attributes are constant over geometries of x
> admin_districts$STATE = states[unlist(test),]$STUSPS
> 
> totcount = fs[,.N,by=.(FOREST_ID)]
> admin_districts = left_join(admin_districts,totcount)
Joining, by = "FOREST_ID"
> 
> us_counties = counties(class = 'sf',year = 2017)
  |                                                                              |                                                                      |   0%  |                                                                              |                                                                      |   1%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |==                                                                    |   4%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |=====                                                                 |   8%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |=======                                                               |  11%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |=========                                                             |  14%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  16%  |                                                                              |============                                                          |  17%  |                                                                              |============                                                          |  18%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |==============                                                        |  21%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  22%  |                                                                              |================                                                      |  23%  |                                                                              |================                                                      |  24%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |===================                                                   |  28%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |=====================                                                 |  31%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |=======================                                               |  34%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |==========================                                            |  38%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  39%  |                                                                              |============================                                          |  40%  |                                                                              |============================                                          |  41%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |==============================                                        |  44%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |=================================                                     |  48%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |===================================                                   |  51%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |=====================================                                 |  54%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  56%  |                                                                              |========================================                              |  57%  |                                                                              |========================================                              |  58%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |==========================================                            |  61%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  62%  |                                                                              |============================================                          |  63%  |                                                                              |============================================                          |  64%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |===============================================                       |  68%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |=================================================                     |  71%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  77%  |                                                                              |======================================================                |  78%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  79%  |                                                                              |========================================================              |  80%  |                                                                              |========================================================              |  81%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |==========================================================            |  84%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |=============================================================         |  88%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |===============================================================       |  91%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |=================================================================     |  94%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |====================================================================  |  98%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================|  99%  |                                                                              |======================================================================| 100%
> us_counties = st_transform(us_counties ,albersNA)
> 
> states = tigris::states(class = 'sf',year = 2015)
  |                                                                              |                                                                      |   0%  |                                                                              |                                                                      |   1%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  16%  |                                                                              |============                                                          |  17%  |                                                                              |============                                                          |  18%  |                                                                              |==============                                                        |  20%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  23%  |                                                                              |================                                                      |  24%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |=====================                                                 |  31%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  39%  |                                                                              |============================                                          |  40%  |                                                                              |============================                                          |  41%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  48%  |                                                                              |==================================                                    |  48%  |                                                                              |===================================                                   |  50%  |                                                                              |===================================                                   |  51%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  55%  |                                                                              |========================================                              |  56%  |                                                                              |=========================================                             |  58%  |                                                                              |==========================================                            |  60%  |                                                                              |==========================================                            |  61%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |===============================================                       |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |====================================================                  |  74%  |                                                                              |=====================================================                 |  75%  |                                                                              |======================================================                |  77%  |                                                                              |======================================================                |  78%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  79%  |                                                                              |========================================================              |  80%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |===========================================================           |  84%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |=================================================================     |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================|  99%  |                                                                              |======================================================================| 100%
> states = st_transform(states,albersNA)
> states <- st_crop(states,st_bbox(admin_districts))
Warning message:
attribute variables are assumed to be spatially constant throughout all geometries 
> us_counties <- st_crop(us_counties,st_bbox(admin_districts))
Warning message:
attribute variables are assumed to be spatially constant throughout all geometries 
> 
> nf = fread('policypolitics/prepped/national_forest_covariates.csv')
> nf$FOREST_ID = formatC(nf$FOREST_ID,width = 4,flag = 0)
> nf$FOREST_NAME = admin_districts$FORESTNAME[match(nf$FOREST_ID,admin_districts$FOREST_ID)]
> nf = nf[congress %in% 108:115,]
> 
> subvars = 'Type_Purpose_Extractive'
> if(period_type=='congress')
+ {obs_grid = data.table(expand.grid(congress = 107:116,FOREST_ID = unique(fs$FOREST_ID),DECISION_TYPE= keep_decisions,Project_Type = subvars))}
> if(period_type=='CALENDAR_YEAR')
+ {obs_grid = data.table(expand.grid(CALENDAR_YEAR = start_year:end_year,FOREST_ID = unique(fs$FOREST_ID),DECISION_TYPE= keep_decisions,Project_Type = subvars))}
> 
> subset_projtypes = lapply(subvars, function(x) {
+   if(period_type=='congress'){
+     temp = fs[get(x)==1,.N,by = .(FOREST_ID,`DECISION TYPE`,congress)]}
+   if(period_type!='congress'){
+     temp = fs[get(x)==1,.N,by = .(FOREST_ID,`DECISION TYPE`,CALENDAR_YEAR)]}
+   setnames(temp,c('DECISION TYPE'),c('DECISION_TYPE'))
+   temp$Project_Type <- x
+   temp = merge(obs_grid[Project_Type==x,],temp,all = T)
+   temp
+ })
> counts_by_type = rbindlist(subset_projtypes,use.names = T)
> counts_by_type$N[is.na(counts_by_type$N)]<-0
> 
> 
> durations = fs[,list(mean(mdy(`DECISION SIGNED`) - mdy(`INITIATION DATE`),na.rm=T),median(mdy(`DECISION SIGNED`) - mdy(`INITIATION DATE`),na.rm=T)),by = .(`DECISION TYPE`)]
> names(durations) <- c('Type','mean','median')
> 
> 
> 
> nf$Num_Eco_Sections[nf$Num_Eco_Sections==0] <- 1
> nf = nf[order(FOREST_ID,get(period_type)),]
> nf = nf[, zoo::na.locf(.SD, na.rm = FALSE),by = .(FOREST_ID)]
> 
> nf$Prop_Extraction_Employ = nf$Prop_Forestry_Employ + nf$Prop_Mining_Employ
> nf$Perc_Extraction_Employ = nf$Prop_Extraction_Employ*100
> nf$Prop_Outdoor_Employ = nf$Prop_HuntingFishing + nf$Prop_Recreation
> nf$Wilderness_Prop = as.numeric(nf$Wilderness_Prop)
> nf$Wilderness_Perc = nf$Wilderness_Prop * 100
> #nf$Limited_Use_Prop = as.numeric(nf$Limited_Use_Prop)
> nf$Prop_WUI_Housing = as.numeric(nf$Prop_WUI_Housing)
> nf$Perc_WUI_Housing = 100 * nf$Prop_WUI_Housing
> nf$Burned_Prop_Past5yrs = as.numeric(nf$Burned_Prop_Past5yrs)
> nf$Burned_Perc_Past5yrs = nf$Burned_Prop_Past5yrs * 100
> nf$ACRES = admin_districts$GIS_ACRES[match(nf$FOREST_ID,admin_districts$FOREST_ID)]
> nf$demCongress[nf$demCongress==2] <- 0
> nf$congress = as.character(nf$congress)
> nf$nominate_dim1  = nf$nominate_dim1  * -1
> nf$nominate_dim2  = nf$nominate_dim2  * -1
> nf$mrp_mean = nf$mrp_mean * -1
> 
> nf$ComLCV = (nf$nrComLCV+nf$agComLCV)/2
> nf$ChairLCV = (nf$nrChairLCV + nf$agChairLCV)/2
> 
> nf$Ln_ACRES = log(nf$ACRES)
> nf$Ln_AVERAGE_YEARLY_VISITS = log(nf$Average_Yearly_Visits)
> nf$USFS_REGION = admin_districts$REGION[match(nf$FOREST_ID,admin_districts$FOREST_ID)]
> 
> library(zoo)

Attaching package: â€˜zooâ€™

The following objects are masked from â€˜package:baseâ€™:

    as.Date, as.Date.numeric

> nf = nf[order(FOREST_ID,congress),]
> nf = nf[order(FOREST_ID,congress), zoo::na.locf(.SD, na.rm = FALSE),by = .(FOREST_ID)]
> nf = nf[order(FOREST_ID,congress), na.locf(.SD, na.rm = FALSE,fromLast=TRUE),by = .(FOREST_ID)]
> nf$congress = as.numeric(nf$congress)
> nf$ln_County_naturalresource_GDP_1M = log(nf$NaturalResources1M+1)
> nf$Prop_Extraction_Employ = nf$Prop_NaturalResourceEmployment
> nf$Perc_Extraction_Employ = nf$Prop_Extraction_Employ * 100
> center_continuous_cov = TRUE
> 
> nf= nf[nf$FOREST_ID%in%admin_districts$FOREST_ID,]
> 
> if(period_type == 'congress'){
+   all_combos = expand.grid(FOREST_ID = sort(unique(admin_districts$FOREST_ID)),congress = 109:115,DECISION_TYPE = c('CE','EA','EIS'))
+ }
> if(period_type !='congress'){
+   all_combos = expand.grid(FOREST_ID = sort(unique(admin_districts$FOREST_ID)),CALENDAR_YEAR = start_year:end_year,DECISION_TYPE = c('CE','EA','EIS'))
+ }
> 
> all_combos = data.table(all_combos)
> subtypes = unique(counts_by_type$Project_Type)
> 
> nf$`Avg_MBF_Cut_1999-2004`[is.na(nf$`Avg_MBF_Cut_1999-2004`)]<-0
> nf$Ln_Avg_MBF_Cut_1999_2004 = log(nf$`Avg_MBF_Cut_1999-2004`+0.001)
> 
> nf$ln_Receipts_Extraction_1M_P4 <- log(nf$Receipts_TimberMineralsGrazing_P4/1e6+1)
> nf$ln_Receipts_Recreation_1M_P4 <- log(nf$Receipts_Recreation_P4/1e6+1)
> 
> nf = nf[order(FOREST_ID,CALENDAR_YEAR),Unemp_Rate:=lag(LAU_October),by = .(FOREST_ID)]
> nf$STATE = admin_districts$STATE[match(nf$FOREST_ID,admin_districts$FOREST_ID)]
> 
> dist_by_year = full_join(admin_districts,nf[,.(FOREST_ID,LCV_annual,CALENDAR_YEAR)])
Joining, by = "FOREST_ID"
> dist_by_year = dist_by_year[!is.na(dist_by_year$CALENDAR_YEAR),]
> 
> dist_by_year = full_join(admin_districts,nf[,.(FOREST_ID,Unemp_Rate ,CALENDAR_YEAR)])
Joining, by = "FOREST_ID"
> dist_by_year = dist_by_year[!is.na(dist_by_year$CALENDAR_YEAR),]
> 
> base_linear_form = Y ~ -1 + mu.u + mu.y + 
+   u_Unemp_Rate +  u_Perc_Extraction_Employ + u_ln_County_naturalresource_GDP_1M + 
+   u_ln_Receipts_Extraction_1M_P4 + 
+   u_Ln_ACRES + u_Wilderness_Perc + 
+   u_Burned_Perc_Past5yrs  + 
+   u_Ln_AVERAGE_YEARLY_VISITS + u_Count_EorT_Species + 
+   u_Perc_WUI_Housing +
+   u_demPres + u_demCongress + 
+   u_mrp_mean +
+   u_LCV_annual + 
+   y_Unemp_Rate +  y_Perc_Extraction_Employ + y_ln_County_naturalresource_GDP_1M + 
+   y_ln_Receipts_Extraction_1M_P4 + 
+   y_Ln_ACRES + y_Wilderness_Perc + 
+   y_Burned_Perc_Past5yrs  + 
+   y_Ln_AVERAGE_YEARLY_VISITS + y_Count_EorT_Species + 
+   y_Perc_WUI_Housing + 
+   y_demPres + y_demCongress +
+   y_mrp_mean +
+   y_LCV_annual 
> 
> form0 = update.formula(base_linear_form, ~ . + 
+                          f(u_forest_id,model = 'iid',hyper = iid_prior_u) + 
+                          f(u_congress_id,model = 'iid',hyper = iid_prior_u) + 
+                          f(u_region_id, model = 'iid',hyper = iid_prior_u) + 
+                          f(u_state_id, model = 'iid',hyper = iid_prior_u) + 
+                          f(y_forest_id,model = 'iid',hyper = iid_prior_y) +
+                          f(y_congress_id,model = 'iid',hyper = iid_prior_y) +
+                          f(y_region_id,model = 'iid',hyper = iid_prior_y) +
+                          f(y_state_id,model = 'iid',hyper = iid_prior_y) )
> 
> form0x = update.formula(form0, ~ . + u_Unemp_Rate:u_LCV_annual + y_Unemp_Rate:y_LCV_annual)
> 
> list_of_forms = grep('form[0-2]',ls(),value=T)
> raw_vars = unlist(lapply(list_of_forms,function(x)  grep('^u_',str_split(as.character(get(x)[[3]])[2],pattern = '\\s\\+\\s')[[1]],value=T) ))
> library(matrixStats)

Attaching package: â€˜matrixStatsâ€™

The following object is masked from â€˜package:dplyrâ€™:

    count

> uvars = grep('^u_',raw_vars,value = T)
> library(stargazer)

Please cite as: 

 Hlavac, Marek (2018). stargazer: Well-Formatted Regression and Summary Statistics Tables.
 R package version 5.2.2. https://CRAN.R-project.org/package=stargazer 

> uvars_no_int = grep(':',uvars,value = T,invert = T)
> uvars_int = grep(':',uvars,value = T,invert = F)
> 
> uvars_interaction_products = as.data.table(sapply(str_split(uvars_int ,':'),function(x) rowProds(as.matrix(nf[FOREST_ID %in% fs$FOREST_ID &CALENDAR_YEAR %in% start_year:end_year,gsub('u_','',(unlist(x))),with = F]))))
> names(uvars_interaction_products) <- gsub('u_','',uvars_int)
> 
> nf = nf[nf$congress%in%109:115,]
> 
> input_data = dcast(counts_by_type,get(period_type) + 
+                      FOREST_ID + Project_Type ~ DECISION_TYPE,value.var = 'N',fill = 0)
> input_data$Tot_Proj = input_data$CE + input_data$EA + input_data$EIS
> if(period_type=='congress'){
+   input_data = input_data[Project_Type=='Type_Purpose_Extractive',][period_type>108&period_type<116,]}
> if(period_type!='congress'){
+   input_data = input_data[Project_Type=='Type_Purpose_Extractive',][period_type>=start_year&period_type<=end_year,]}
> 
> yheight = input_data[,.N,by = .(Tot_Proj)][N==max(N),]$N
> 
> 
> forest_index = data.table(forest_id = sort(unique(nf$FOREST_ID)),index = seq_along(unique(nf$FOREST_ID)))
> region_index = data.table(region_id = sort(unique(nf$USFS_REGION)),index = seq_along(unique(nf$USFS_REGION)))
> state_index = data.table(state_id = sort(unique(nf$STATE)),index = seq_along(unique(nf$STATE)))
> congress_index = data.table(congress_id = sort(unique(nf$congress)),index = seq_along(unique(nf$congress)))
> 
> subtypes =  "Type_Purpose_Extractive" 
> mod = subtypes; nf = nf; project_type_counts_for_model = counts_by_type;period = period_type
> 
> 
> temp_count = project_type_counts_for_model[Project_Type==mod,,]
> temp_count = dcast(temp_count ,get(period_type) + FOREST_ID ~ DECISION_TYPE,fill = 0,value.var = 'N')
> setnames(temp_count,'period_type',period_type)
> if(period=='congress'){
+   temp_nf = nf[order(FOREST_ID,get(period_type)),][!duplicated(paste(FOREST_ID,congress)),]}
> if(period=='CALENDAR_YEAR'){
+   temp_nf = nf[order(FOREST_ID,get(period_type)),]}
> temp_dt = merge(temp_count,temp_nf,by = c('FOREST_ID',period_type))#,all=T,by = c('FOREST_ID',congress))
> 
> temp_dt$ln_Receipts_Extraction_1M_P4[is.na(temp_dt$ln_Receipts_Extraction_1M_P4)] <- 0
> n = nrow(temp_dt)
> u = rowSums(temp_dt[,c('CE','EA','EIS'),with = F])
> narep = length(u)
> y <- ifelse(u>0,temp_dt$CE,NA)
> idat <- list(Y=matrix(NA,2*n,2))
> idat$Y[1:n,1] <- u
> idat$Y[n+1:n,2] <- y
> idat$mu.u <- rep(c(1,NA), each=n)
> idat$mu.y <- rep(c(NA,1), each=n)
> 
> 
> idat$u_forest_id = c(temp_dt$FOREST_ID,rep(NA,length(y)))#temp_dt$FOREST_ID)
> idat$uc_forest_id = c(rep(NA,length(y)),idat$u_forest_id[1:length(u)])
> idat$y_forest_id = c(rep(NA,length(y)),idat$u_forest_id[1:length(u)])
> 
> idat$u_congress_id = c(temp_dt$congress,rep(NA,length(y)))
> idat$uc_congress_id =  c(rep(NA,length(y)),idat$u_congress_id[1:length(u)])
> idat$y_congress_id = c(rep(NA,length(y)),idat$u_congress_id[1:length(u)])
> 
> idat$u_year_id = c(temp_dt$CALENDAR_YEAR,rep(NA,length(y)))
> idat$uc_year_id =  c(rep(NA,length(y)),idat$u_year_id[1:length(u)])
> idat$y_year_id =   c(rep(NA,length(y)),idat$u_year_id[1:length(u)])
> 
> idat$u_state_id = c(temp_dt$STATE,rep(NA,length(y)))
> idat$uc_state_id = c(rep(NA,length(y)),idat$u_state_id[1:length(u)])
> idat$y_state_id = c(rep(NA,length(y)),idat$u_state_id[1:length(u)])
> 
> idat$u_region_id = c(formatC(temp_dt$USFS_REGION,width = 2,flag=0),rep(NA,length(y)))
> idat$uc_region_id = c(rep(NA,length(y)),idat$u_region_id[1:length(u)])
> idat$y_region_id = c(rep(NA,length(y)),idat$u_region_id[1:length(u)])
> 
> #### binomial EIS / [EA+EIS] model coefficients
> #idat$y_FOREST_LEVEL_DECISIONS = c(rep(NA,narep),scale(temp_dt$FOREST_LEVEL_DECISIONS))
> idat$y_Unemp_Rate = c(rep(NA,narep),scale(temp_dt$Unemp_Rate))
> #idat$y_Unemp_Rate_L1 = c(rep(NA,narep),scale(temp_dt$Unemp_Rate_L1))
> idat$y_ln_Receipts_Extraction_1M_P4 = c(rep(NA,narep),scale(temp_dt$ln_Receipts_Extraction_1M_P4))
> 
> idat$y_Perc_Extraction_Employ = c(rep(NA,narep),scale(temp_dt$Perc_Extraction_Employ))
> #idat$y_Perc_Extraction_Employ_L1 = c(rep(NA,narep),scale(temp_dt$Perc_Extraction_Employ_L1))
> idat$y_Ln_ACRES = c(rep(NA,narep),scale(temp_dt$Ln_ACRES))
> idat$y_Wilderness_Perc = c(rep(NA,narep),scale(temp_dt$Wilderness_Perc)) 
> idat$y_Burned_Perc_Past5yrs = c(rep(NA,narep),scale(temp_dt$Burned_Perc_Past5yrs)) 
> idat$y_Ln_AVERAGE_YEARLY_VISITS = c(rep(NA,narep),scale(temp_dt$Ln_AVERAGE_YEARLY_VISITS)) 
> idat$y_Count_EorT_Species= c(rep(NA,narep),scale(temp_dt$Count_EorT_Species)) 
> idat$y_percentD_H = c(rep(NA,narep),scale(temp_dt$percentD_H)) 
> #idat$y_democrat = c(rep(NA,narep),scale(temp_dt$democrat))  
> idat$y_LCV_annual= c(rep(NA,narep),scale(temp_dt$LCV_annual))
> idat$y_mrp_mean= c(rep(NA,narep),scale(temp_dt$mrp_mean))
> 
> #idat$y_nominate_dim1 = c(rep(NA,narep),scale(temp_dt$nominate_dim1))
> #idat$y_nominate_dim1_x_y_democrat =  c(rep(NA,narep),scale(temp_dt$nominate_dim1) * scale(temp_dt$democrat))
> idat$y_demPres = c(rep(NA,narep),temp_dt$demPres)
> idat$y_demCongress = c(rep(NA,narep),temp_dt$demCongress)
> idat$y_ComLCV = c(rep(NA,narep),scale(temp_dt$ComLCV))
> idat$y_ChairLCV = c(rep(NA,narep),scale(temp_dt$ChairLCV))
> idat$y_Perc_WUI_Housing = c(rep(NA,narep),scale(temp_dt$Perc_WUI_Housing))
> 
> idat$y_ln_County_naturalresource_GDP_1M = c(rep(NA,narep),scale(temp_dt$ln_County_naturalresource_GDP_1M))
> idat$y_Total_Receipts_4yr_Change_Perc = c(rep(NA,narep),scale(temp_dt$Total_Receipts_4yr_Change_Perc))
> idat$u_Unemp_Rate = c(scale(temp_dt$Unemp_Rate),rep(NA,narep))
> 
> temp_dt$ln_Receipts_Extraction_1M_P4[is.na(temp_dt$ln_Receipts_Extraction_1M_P4)] <- 0
> idat$u_ln_Receipts_Extraction_1M_P4 = c(scale(temp_dt$ln_Receipts_Extraction_1M_P4),rep(NA,narep))
> 
> idat$u_Perc_Extraction_Employ = c(scale(temp_dt$Perc_Extraction_Employ),rep(NA,narep))
> 
> idat$u_Perc_WUI_Housing = c(scale(temp_dt$Perc_WUI_Housing),rep(NA,narep))
> idat$u_Ln_ACRES = c(scale(temp_dt$Ln_ACRES),rep(NA,narep))
> idat$u_Wilderness_Perc = c(scale(temp_dt$Wilderness_Perc),rep(NA,narep)) 
> idat$u_Burned_Perc_Past5yrs = c(scale(temp_dt$Burned_Perc_Past5yrs),rep(NA,narep)) 
> idat$u_Ln_AVERAGE_YEARLY_VISITS = c(scale(temp_dt$Ln_AVERAGE_YEARLY_VISITS),rep(NA,narep)) 
> idat$u_Count_EorT_Species= c(scale(temp_dt$Count_EorT_Species),rep(NA,narep)) 
> idat$u_percentD_H = c(scale(temp_dt$percentD_H),rep(NA,narep)) 
> #idat$u_democrat = c(scale(temp_dt$democrat),rep(NA,narep))  
> idat$u_LCV_annual= c(scale(temp_dt$LCV_annual),rep(NA,narep)) 
> idat$u_mrp_mean = c(scale(temp_dt$mrp_mean),rep(NA,narep)) 
> idat$u_democrat = c(temp_dt$democrat,rep(NA,narep))
> idat$y_democrat = c(rep(NA,narep),temp_dt$democrat)
> idat$u_demPres = c(temp_dt$demPres,rep(NA,narep))
> idat$u_demCongress = c(temp_dt$demCongress,rep(NA,narep))
> idat$u_ComLCV = c(scale(temp_dt$ComLCV),rep(NA,narep))
> idat$u_ChairLCV = c(scale(temp_dt$ChairLCV),rep(NA,narep))
> idat$u_ln_County_naturalresource_GDP_1M = c(scale(temp_dt$ln_County_naturalresource_GDP_1M),rep(NA,narep))
> 
> # idat$u_ln_County_naturalresource_GDP_1M_L1 = c(scale(temp_dt$ln_County_naturalresource_GDP_1M_L1),rep(NA,narep))
> idat$n = n;idat$y = y;idat$u = u;
> 
> library(INLA)
> pcount = fs[fs$congress>=109&fs$congress<=115,]
> table(pcount$`DECISION TYPE`)

   CE    EA   EIS 
28053  5387   624 
> table(pcount$`DECISION TYPE`,pcount$Type_Purpose_Extractive)
     
          0     1
  CE  23131  4922
  EA   2899  2488
  EIS   330   294
> 
> library(ggrepel)
> 
> 
> counts_by_type[Project_Type=='Type_Purpose_Extractive',][order(-N),][CALENDAR_YEAR==start_year&FOREST_ID=='0302',]
   CALENDAR_YEAR FOREST_ID DECISION_TYPE            Project_Type N
1:          2005      0302            EA Type_Purpose_Extractive 5
2:          2005      0302            CE Type_Purpose_Extractive 3
3:          2005      0302           EIS Type_Purpose_Extractive 0
> counts_by_type[Project_Type=='Type_Purpose_Extractive',sum(N),by=.(CALENDAR_YEAR,FOREST_ID)][order(-V1),][CALENDAR_YEAR==start_year&FOREST_ID=='0302',]
   CALENDAR_YEAR FOREST_ID V1
1:          2005      0302  8
> 
> 
> counts_by_type$UNIT = admin_districts$FORESTNAME[match(counts_by_type$FOREST_ID,admin_districts$FOREST_ID)]
> 
> counts_by_type[Project_Type=='Type_Purpose_Extractive',][,sum(N)]
[1] 7704
> 
> subtypes = grep('Extract',subtypes,value = T)
> 
> u.sdres <- sd(idat$u,na.rm = T)
> y.sdres <- sd(idat$y/idat$u,na.rm=T)
> 
> pc.prec.u = list(prec = list(prior = "pc.prec", param = c(3*u.sdres, 0.01)))
> pc.prec.y = list(prec = list(prior = "pc.prec", param = c(3*y.sdres, 0.01)))
> bprior <- list(prior = 'gaussian', param = c(0,1))
> 
> #cinla <- list(strategy = 'adaptive', int.strategy = 'eb') 
> cres <- list(return.marginals.predictor = FALSE, 
+              return.marginals.random = FALSE)
> 
> idat$u_forest_id <- forest_index$index[match(idat$u_forest_id,forest_index$forest_id)]
> idat$y_forest_id <- forest_index$index[match(idat$y_forest_id,forest_index$forest_id)] + nrow(forest_index)
> idat$uc_forest_id <-  idat$u_forest_id
> 
> idat$u_region_id <- region_index$index[match(idat$u_region_id,region_index$region_id)]
> idat$y_region_id <- region_index$index[match(idat$y_region_id,region_index$region_id)] + nrow(region_index)
> idat$uc_region_id <-  idat$u_region_id
> 
> idat$u_state_id <- state_index$index[match(idat$u_state_id,state_index$state_id)]
> idat$y_state_id <- state_index$index[match(idat$y_state_id,state_index$state_id)] + nrow(state_index)
> idat$uc_state_id <-  idat$u_state_id
> 
> idat$u_congress_id <- congress_index$index[match(idat$u_congress_id,congress_index$congress_id)]
> idat$y_congress_id <- congress_index$index[match(idat$y_congress_id,congress_index$congress_id)] + nrow(congress_index)
> idat$uc_congress_id <-  idat$u_congress_id
> 
> 
> HN.prior = "expression:
+   tau0 = 0.001;
+   sigma = exp(-theta/2);
+   log_dens = log(2) - 0.5 * log(2 * pi) + 0.5 * log(tau0);
+   log_dens = log_dens - 0.5 * tau0 * sigma^2;
+   log_dens = log_dens - log(2) - theta / 2;
+   return(log_dens);  
+ "
> HT.prior = "expression:
+   sigma = exp(-theta/2);
+   nu = 3;
+   log_dens = 0 - 0.5 * log(nu * pi) - (-0.1207822);
+   log_dens = log_dens - 0.5 * (nu + 1) * log(1 + sigma * sigma);
+   log_dens = log_dens - log(2) - theta / 2;
+   return(log_dens);
+ "
> 
> UN.prior = "expression:
+   log_dens = 0 - log(2) - theta / 2;
+   return(log_dens);
+ "
> 
> HC.prior  = "expression:
+   sigma = exp(-theta/2);
+   gamma = 25;
+   log_dens = log(2) - log(pi) - log(gamma);
+   log_dens = log_dens - log(1 + (sigma / gamma)^2);
+   log_dens = log_dens - log(2) - theta / 2;
+   return(log_dens);
+ "
> 
> 
> 
> require(MASS)
Loading required package: MASS

Attaching package: â€˜MASSâ€™

The following object is masked from â€˜package:dplyrâ€™:

    select

> require(aod)
Loading required package: aod
>  nb_mod = glm.nb(u~ -1 + mu.u + u_Unemp_Rate + u_Perc_Extraction_Employ + u_ln_County_naturalresource_GDP_1M +
+    u_ln_Receipts_Extraction_1M_P4 + u_Ln_ACRES + u_Wilderness_Perc +
+    u_Burned_Perc_Past5yrs + u_Ln_AVERAGE_YEARLY_VISITS + u_Count_EorT_Species +
+    u_Perc_WUI_Housing + u_demPres + u_demCongress + u_mrp_mean +
+    u_LCV_annual,data = lapply(idat,function(x) x[1:length(idat$u)]))
> 
>  u.sdres <- sd(residuals(nb_mod))
>  
> temp_dat = as.data.frame(lapply(idat,function(x) x[length(idat$u)+{1:length(idat$y)}]))
> keep_index = which(!is.na(idat$y))
> drop_index = which(is.na(idat$y))
> temp_dat = temp_dat[keep_index,]
> temp_dat$y = idat$y[keep_index]
> temp_dat$u = idat$u[keep_index]
> 
> bin_mod = betabin(cbind(y,u-y) ~ 1 + 
+                     y_Unemp_Rate + 
+                  y_Perc_Extraction_Employ + 
+                     y_ln_County_naturalresource_GDP_1M +
+                  y_ln_Receipts_Extraction_1M_P4 + 
+                   y_Ln_ACRES + y_Wilderness_Perc +
+                y_Burned_Perc_Past5yrs + y_Ln_AVERAGE_YEARLY_VISITS + y_Count_EorT_Species +
+                  y_Perc_WUI_Housing + 
+                 y_demPres + y_demCongress + 
+                 y_mrp_mean +
+                  y_LCV_annual,~1,data =  temp_dat,control = list(maxit = 10e3))
> 
> y.sdres <- sd(residuals(bin_mod))
Warning message:
In model.matrix.default(mt, mfb, contrasts) :
  non-list contrasts argument ignored
> 
> u.resp <- sd(idat$u,na.rm = T)
> y.resp <- sd(idat$y/idat$u,na.rm=T)
> 
> 
> #pcprior <- list(prec = list(prior="pc.prec", param = c(3*sdres,0.01)))
> famcontrol = list(list(prior = "pcprec", param = c(u.resp,0.01)),
+                   list(prior = "pcprec", param = c(y.resp,0.01)))
> 
> prior.list = list(
+   loggamma0.5 = list(prec = list(prior = "loggamma", param = c(0.5, 0.00005))),
+   loggamma1 = list(prec = list(prior = "loggamma", param = c(1, 0.00005))),
+   loggamma5 = list(prec = list(prior = "loggamma", param = c(5, 0.00005))),
+   half.normal = list(prec = list(prior = HN.prior)),
+   half.cauchy = list(prec = list(prior = HC.prior)),
+   h.t = list(prec = list(prior = HT.prior)),
+   uniform = list(prec = list(prior = UN.prior)),
+   pc.prec.1 = list(prec = list(prior = "pc.prec", param = c(1,0.01))),
+   pc.prec.3 = list(prec = list(prior = "pc.prec", param = c(3, 0.01))),
+   pc.prec.5 = list(prec = list(prior = "pc.prec", param = c(5, 0.01))),
+   pc.prec.10 = list(prec = list(prior = "pc.prec", param = c(10, 0.01))),
+   pc.prec.used = list(prec= list(prior = "pc.prec", param = c(u.sdres,0.01)),
+                       prec = list(prior = "pc.prec", param = c(y.sdres,0.01)))
+ ) 
> 
> require(pbapply)
Loading required package: pbapply
> mod_list = pblapply(prior.list,function(f) {print(f);gc();
+   if(length(f)==1){iid_prior_u = iid_prior_y = f}
+   if(length(f)>1){
+   iid_prior_u <- list(prec= list(prior = "pc.prec", param = c(3*u.sdres,0.01)))
+   iid_prior_y <- list(prec = list(prior = "pc.prec", param = c(3*y.sdres,0.01)))
+   }
+   tmod = inla(form0x,family = c('nbinomial', 'betabinomial'),Ntrials = idat$u,
+        control.fixed = list(expand.factor.strategy = "model.matrix",prec = bprior),
+        control.family = famcontrol,
+        control.results = cres,
+        data=idat, control.compute = list(waic=TRUE),
+        control.predictor=list(compute=TRUE),verbose=F)
+   tmod$prior = f
+   tmod
+ },cl = 1)
$prec
$prec$prior
[1] "loggamma"

$prec$param
[1] 5e-01 5e-05




*** Warning *** You might want to consider to setting ``control.predictor=list(link=...)''
*** Warning *** otherwise the identity link will be used to compute the fitted values for NA data


$prec
$prec$prior
[1] "loggamma"

$prec$param
[1] 1e+00 5e-05




*** Warning *** You might want to consider to setting ``control.predictor=list(link=...)''
*** Warning *** otherwise the identity link will be used to compute the fitted values for NA data


$prec
$prec$prior
[1] "loggamma"

$prec$param
[1] 5e+00 5e-05




*** Warning *** You might want to consider to setting ``control.predictor=list(link=...)''
*** Warning *** otherwise the identity link will be used to compute the fitted values for NA data


$prec
$prec$prior
[1] "expression:\n  tau0 = 0.001;\n  sigma = exp(-theta/2);\n  log_dens = log(2) - 0.5 * log(2 * pi) + 0.5 * log(tau0);\n  log_dens = log_dens - 0.5 * tau0 * sigma^2;\n  log_dens = log_dens - log(2) - theta / 2;\n  return(log_dens);  \n"




*** Warning *** You might want to consider to setting ``control.predictor=list(link=...)''
*** Warning *** otherwise the identity link will be used to compute the fitted values for NA data


$prec
$prec$prior
[1] "expression:\n  sigma = exp(-theta/2);\n  gamma = 25;\n  log_dens = log(2) - log(pi) - log(gamma);\n  log_dens = log_dens - log(1 + (sigma / gamma)^2);\n  log_dens = log_dens - log(2) - theta / 2;\n  return(log_dens);\n"




*** Warning *** You might want to consider to setting ``control.predictor=list(link=...)''
*** Warning *** otherwise the identity link will be used to compute the fitted values for NA data


$prec
$prec$prior
[1] "expression:\n  sigma = exp(-theta/2);\n  nu = 3;\n  log_dens = 0 - 0.5 * log(nu * pi) - (-0.1207822);\n  log_dens = log_dens - 0.5 * (nu + 1) * log(1 + sigma * sigma);\n  log_dens = log_dens - log(2) - theta / 2;\n  return(log_dens);\n"




*** Warning *** You might want to consider to setting ``control.predictor=list(link=...)''
*** Warning *** otherwise the identity link will be used to compute the fitted values for NA data


$prec
$prec$prior
[1] "expression:\n  log_dens = 0 - log(2) - theta / 2;\n  return(log_dens);\n"




*** Warning *** You might want to consider to setting ``control.predictor=list(link=...)''
*** Warning *** otherwise the identity link will be used to compute the fitted values for NA data


$prec
$prec$prior
[1] "pc.prec"

$prec$param
[1] 1.00 0.01




*** Warning *** You might want to consider to setting ``control.predictor=list(link=...)''
*** Warning *** otherwise the identity link will be used to compute the fitted values for NA data


$prec
$prec$prior
[1] "pc.prec"

$prec$param
[1] 3.00 0.01




*** Warning *** You might want to consider to setting ``control.predictor=list(link=...)''
*** Warning *** otherwise the identity link will be used to compute the fitted values for NA data


$prec
$prec$prior
[1] "pc.prec"

$prec$param
[1] 5.00 0.01




*** Warning *** You might want to consider to setting ``control.predictor=list(link=...)''
*** Warning *** otherwise the identity link will be used to compute the fitted values for NA data


$prec
$prec$prior
[1] "pc.prec"

$prec$param
[1] 10.00  0.01




*** Warning *** You might want to consider to setting ``control.predictor=list(link=...)''
*** Warning *** otherwise the identity link will be used to compute the fitted values for NA data


$prec
$prec$prior
[1] "pc.prec"

$prec$param
[1] 1.012625 0.010000


$prec
$prec$prior
[1] "pc.prec"

$prec$param
[1] 1.02171 0.01000




*** Warning *** You might want to consider to setting ``control.predictor=list(link=...)''
*** Warning *** otherwise the identity link will be used to compute the fitted values for NA data


> 
> 
> saveRDS(mod_list,'policypolitics/model_objects/prior_sensitivity_mods.RDS')
> 
> sapply(mod_list,function(x) x$waic$waic)
 loggamma0.5    loggamma1    loggamma5  half.normal  half.cauchy          h.t 
    10920.09     10923.42     11107.59     10917.26     10917.12     10916.70 
     uniform    pc.prec.1    pc.prec.3    pc.prec.5   pc.prec.10 pc.prec.used 
    10917.04     10918.04     10917.20     10917.38     10917.46     10916.93 
> 
> hpars = lapply(mod_list,'[[','summary.hyperpar')
> 
> hypers = rbindlist(hpars)
> hypers$prior = c(mapply(function(x,y) rep(x,y), x = names(hpars),y = sapply(hpars,nrow),SIMPLIFY = T))
> hypers$param = unlist(lapply(hpars,rownames))
> 
> hypers$prior[hypers$prior=='pc.prec.10'] <- 'PC prior (10)'
> hypers$prior[hypers$prior=='pc.prec.3'] <- 'PC prior (3)'
> hypers$prior[hypers$prior=='pc.prec.1'] <- 'PC prior (1)'
> hypers$prior[hypers$prior=='pc.prec.5'] <- 'PC prior (5)'
> require(forcats)
> 
> hypers$prior = as.factor(hypers$prior)
> hypers$prior = fct_recode(hypers$prior,'PC prior, sd(resid.)'='pc.prec.used',
+                         'Half t' ="h.t" , 'Half Cauchy'="half.cauchy"   ,'Half normal'  = "half.normal" ,         
+                          'Log-gamma (0.5)'= "loggamma0.5" ,  'Log-gamma (1)'="loggamma1"  ,   'Log-gamma (5)'="loggamma5"  ,            
+                   'Uniform'= "uniform")
> 
> hypers$prior <- fct_relevel(hypers$prior, "Uniform"  , "Half normal","Half t","Half Cauchy",
+                             "Log-gamma (0.5)" , "Log-gamma (1)" , "Log-gamma (5)"   ,       
+                             "PC prior (1)" ,  "PC prior (3)" , "PC prior (5)" ,   "PC prior (10)" , "PC prior, sd(residuals)" )
Warning message:
Unknown levels in `f`: PC prior, sd(residuals) 
> 
> hypers$param <- gsub('Precision for u_(.+)_id$','\\1 (# projects)',hypers$param)
> hypers$param <- gsub('Precision for y_(.+)_id$','\\1 (CE ratio)',hypers$param)
> 
> 
> gg_priors = ggplot(hypers[!grepl('dispersion',param),]) + 
+   geom_errorbarh(aes(xmin = `0.025quant`,xmax = `0.975quant`,y=prior)) + 
+   facet_wrap(~param,scales='free',ncol = 2) + theme_bw() + ylab('Prior distribution') +
+   xlab('Hyperparameter precision estimates')+
+   ggtitle('Sensitivity of iid latent effects to prior distribution',
+           '(scale varies by panel)')
> 
> ggsave(filename = 'policypolitics/tables_figures/figures/prior_sensitivity.png',plot = gg_priors,width= 7,height = 9,dpi = 500,units = 'in')
> 
> 
> 
> res = rbindlist(lapply(seq_along(mod_list),function(x) data.table(prior = names(mod_list)[x],
+                                                                   mod_list[[x]]$summary.fixed,coef = rownames(mod_list[[x]]$summary.fixed))))
> res = res[grepl('Unemp|LCV',coef),]
> 
> res$lik = ifelse(grepl('^u_',res$coef),'# projects','CE ratio')
> 
> res$lik <- fct_inorder(as.factor(res$lik))
> res$coef = ifelse(grepl(':',res$coef),'Unemp. % x LCV score',ifelse(grepl('Unemp',res$coef),'Unemployment %','LCV score'))
> 
> res$prior[res$prior=='pc.prec.10'] <- 'PC prior (10)'
> res$prior[res$prior=='pc.prec.3'] <- 'PC prior (3)'
> res$prior[res$prior=='pc.prec.1'] <- 'PC prior (1)'
> res$prior[res$prior=='pc.prec.5'] <- 'PC prior (5)'
> 
> res$prior = fct_recode(res$prior,'PC prior, sd(resid.)'='pc.prec.used',
+                           'Half t' ="h.t" , 'Half Cauchy'="half.cauchy"   ,'Half normal'  = "half.normal" ,         
+                           'Log-gamma (0.5)'= "loggamma0.5" ,  'Log-gamma (1)'="loggamma1"  ,   'Log-gamma (5)'="loggamma5"  ,            
+                           'Uniform'= "uniform")
> 
> res$prior <- fct_relevel(res$prior, "Uniform"  , "Half normal","Half t","Half Cauchy",
+                             "Log-gamma (0.5)" , "Log-gamma (1)" , "Log-gamma (5)"   ,       
+                             "PC prior (1)" ,  "PC prior (3)" , "PC prior (5)" ,   "PC prior (10)" , "PC prior, sd(residuals)" )
Warning message:
Unknown levels in `f`: PC prior, sd(residuals) 
> 
> 
> res$coef = as.factor(res$coef)
> res$coef = fct_relevel(res$coef,'Unemployment %',after=1L)
> 
> focal_priors = ggplot(data = res,aes(x = prior,y = mean,ymin = `0.025quant`,ymax = `0.975quant`)) +
+   geom_errorbar() + #geom_point() + 
+   geom_hline(yintercept = 0,lty = 2,col = 'grey50')+
+   facet_wrap(coef~lik,ncol = 2) + coord_flip() + theme_bw() +xlab('Prior distribution')+
+   ylab('95% credible interval') + ggtitle('Focal parameter estimates w/ \ndifferent priors in iid latent effects')
> 
> ggsave(filename = 'policypolitics/tables_figures/figures/focal_prior_sensitivity.png',plot = focal_priors,width= 5,height = 6.25,dpi = 500,units = 'in')
> 
> 
> 
> 
> 
> 
> 
> 
> 
